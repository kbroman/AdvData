\documentclass[aspectratio=169,12pt,t]{beamer}
\usepackage{graphicx}
\setbeameroption{hide notes}
\setbeamertemplate{note page}[plain]
\usepackage{listings}

\input{../LaTeX/header.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% end of header
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{Permutation tests}
\author{\href{https://kbroman.org}{Karl Broman}}
\institute{Biostatistics \& Medical Informatics, UW{\textendash}Madison}
\date{\href{https://kbroman.org}{\tt \scriptsize \color{foreground} kbroman.org}
\\[-4pt]
\href{https://github.com/kbroman}{\tt \scriptsize \color{foreground} github.com/kbroman}
\\[-4pt]
\href{https://twitter.com/kwbroman}{\tt \scriptsize \color{foreground} @kwbroman}
\\[-4pt]
{\scriptsize Course web: \href{https://kbroman.org/AdvData}{\tt kbroman.org/AdvData}}
}

\begin{document}

{
\setbeamertemplate{footline}{} % no page number here
\frame{
  \titlepage

\note{
  In this lecture, we'll look at permutation tests. When they are
  appropriate, I prefer them.
}
} }



\begin{frame}[c]{Randomized experiment}

\figh{Figs/experiment.pdf}{0.9}

\note{
   Consider a randomized experiment with two treatment groups, treated
   (T) and control (C).

   How to tell whether the treatment has an effect?
}
\end{frame}



\begin{frame}[c]{Experimental results}

\figh{Figs/experiment_results.pdf}{0.9}

\note{
  The standard t-test gives a p-value of 0.01.

  What assumptions are made here?

  I find the permutation test to be more natural, and it only relies
  on the assumption of random assignment of treatment groups.
}
\end{frame}




\begin{frame}[c]{Permuted results}

\only<1>{\figh{Figs/perm_results1.pdf}{0.9}}
\only<2|handout 0>{\figh{Figs/perm_results2.pdf}{0.9}}
\only<3|handout 0>{\figh{Figs/perm_results3.pdf}{0.9}}
\only<4|handout 0>{\figh{Figs/perm_results4.pdf}{0.9}}

\note{
  Here are results when you permute the treatment assignments. Do the
  observed results show a sufficiently strong effect that we can be
  confident that it's real?
}
\end{frame}




\begin{frame}[c]{10,000 permutations}

\only<1|handout 0>{\figh{Figs/perm_hist.pdf}{0.9}}
\only<2|handout 0>{\figh{Figs/perm_hist_with_t.pdf}{0.9}}
\only<3>{\figh{Figs/perm_hist_with_arrow.pdf}{0.9}}

\note{
  Here are the t statistics from 10,000 permutations of our data.

  We've superposed a t distribution with 22 degrees; note how closely
  it matches.

  Fisher noted the close correspondance between the theoretical
  t-distribution and the permutation distribution, and used this to
  justify use of probabilities from the t-distribution. The
  permutation results were what he wanted, but they were too difficult
  to obtain at the time, and the t-distribution provided a good
  approximation.
}
\end{frame}



\begin{frame}[c]{Assumptions for the permutation test}

\centering

  {\large The observations are {\vhilit exchangeable} \\[8pt]
    under the null hypothesis.}

\note{
  The only assumption for the permutation test is that the
  observations are exchangeable. Basically this means that the labels
  don't matter. It's a weaker assumption than that they are
  independent and identically distributed.

  For a randomized experiment, this is true by design.

  Basically you want the data to be as if they were assigned to
  treatment groups at random.
}
\end{frame}





\begin{frame}{What test statistic?}

  \bbi
  \item Anything will be {\hilit valid}
  \item Focus on {\vhilit power}
  \item Robustness can still be important
    \bi
  \item[] For example, resistance to outliers
    \ei
  \ei

\note{
  Here, we used the t statistic. But you can use {\hilit any}
  statistic you want with the permutation test.

  Much of the time, we choose statistics based on their null
  distribution being something we can approximate. But we don't care
  about that, since we can simulate to get an approximation of the
  permutation distribution.

  The focus is on {\hilit power}: what statistic will best show the
  expected effect? But note that we may still need to worry about
  robustness, as things like outliers can distort the permutation
  distribution and so weaken our ability to see real effects.
}
\end{frame}




\begin{frame}{How many permutations?}

  \bbi
  \item Typically n = 1,000 or 10,000
  \item Focus on getting a good estimate of the p-value
  \item X = number of permutations $\ge$ observed value \\[8pt]
    \hspace{3mm} $\sim$ binomial(n, p) where p = true p-value
  \item With small datasets, may be able to do an {\hilit exhaustive enumeration}.
    \ei

\note{
    How many permutation replicates to do? I view it as an effort to
    estimate the p-value, or to estimate the significance threshold
    with $\alpha=0.05$ or so.

    Typically I'll do 1,000 or 10,000. In some cases (for example,
    when I'm trying to control some false discovery rate), I may need
    to do many more.
}
\end{frame}



\begin{frame}[c]{}
\figh{Figs/churchill_doerge.png}{0.95}
\note{
  This paper introduced the idea of using a permutation test to assess
  signifiance in QTL mapping. The key issue is in controlling for the
  scan across the genome.
}
\end{frame}




\begin{frame}[c]{}
\figh{Figs/manichaikul_sig_thr.png}{0.95}
\note{
  A friend asked about what to do for significance thresholds in the
  case of selective genotyping. This is a very short paper
  demonstrating the use of a stratified permutation test.
}
\end{frame}



\end{document}
